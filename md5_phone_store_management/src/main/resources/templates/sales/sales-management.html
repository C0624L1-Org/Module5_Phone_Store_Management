<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý Bán hàng</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
<div class="wrapper">
  <!-- Sidebar (giữ nguyên như các trang khác) -->

  <!-- Page Content -->
  <div id="content">
    <!-- Top Navbar (giữ nguyên như các trang khác) -->

    <!-- Main Content -->
    <div class="container-fluid">
      <h2 class="mb-4">Quản lý Bán hàng</h2>

      <div class="card">
        <div class="card-body">
          <form id="salesForm">
            <!-- Thông tin khách hàng -->
            <div class="mb-3">
              <h5>Thông tin Khách hàng</h5>
              <select class="form-select mb-2" id="customerSelect">
                <option value="">-- Chọn khách hàng --</option>
                <option value="new">Khách hàng mới</option>
                <!-- Thêm các option khách hàng từ database -->
              </select>
              <div id="newCustomerInfo" style="display: none;">
                <input type="text" class="form-control mb-2" placeholder="Tên khách hàng">
                <input type="tel" class="form-control mb-2" placeholder="Số điện thoại">
                <input type="email" class="form-control mb-2" placeholder="Email">
                <input type="text" class="form-control mb-2" placeholder="Địa chỉ">
              </div>
            </div>

            <!-- Chọn sản phẩm -->
            <div class="mb-3">
              <h5>Chọn Sản phẩm</h5>
              <div id="productList">
                <!-- Sản phẩm sẽ được thêm vào đây -->
              </div>
              <button type="button" class="btn btn-primary mt-2" id="addProductBtn">
                <i class="fas fa-plus"></i> Thêm sản phẩm
              </button>
            </div>

            <!-- Tổng cộng -->
            <div class="mb-3">
              <h5>Tổng cộng</h5>
              <p>Tổng tiền: <span id="totalAmount">0</span> VNĐ</p>
            </div>

            <!-- Hình thức thanh toán -->
            <div class="mb-3">
              <h5>Hình thức Thanh toán</h5>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="cashPayment" value="cash" checked>
                <label class="form-check-label" for="cashPayment">Tiền mặt</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="vnpayPayment" value="vnpay">
                <label class="form-check-label" for="vnpayPayment">VNPay</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="paypalPayment" value="paypal">
                <label class="form-check-label" for="paypalPayment">PayPal</label>
              </div>
            </div>

            <!-- Nút thanh toán và in hóa đơn -->
            <button type="submit" class="btn btn-success">Thanh toán</button>
            <button type="button" class="btn btn-secondary" id="printInvoiceBtn">In hóa đơn</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal thêm sản phẩm -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Thêm Sản phẩm</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addProductForm">
          <div class="mb-3">
            <label for="productName" class="form-label">Tên sản phẩm</label>
            <input type="text" class="form-control" id="productName" required>
          </div>
          <div class="mb-3">
            <label for="productPrice" class="form-label">Đơn giá</label>
            <input type="number" class="form-control" id="productPrice" required>
          </div>
          <div class="mb-3">
            <label for="productQuantity" class="form-label">Số lượng</label>
            <input type="number" class="form-control" id="productQuantity" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-primary" id="confirmAddProduct">Thêm</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- jsPDF for generating PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Custom JS -->
<script>
  // Khởi tạo jsPDF
  const { jsPDF } = window.jspdf;

  document.addEventListener('DOMContentLoaded', function() {
    const customerSelect = document.getElementById('customerSelect');
    const newCustomerInfo = document.getElementById('newCustomerInfo');
    const addProductBtn = document.getElementById('addProductBtn');
    const addProductModal = new bootstrap.Modal(document.getElementById('addProductModal'));
    const confirmAddProduct = document.getElementById('confirmAddProduct');
    const productList = document.getElementById('productList');
    const totalAmount = document.getElementById('totalAmount');
    const printInvoiceBtn = document.getElementById('printInvoiceBtn');

    // Xử lý hiển thị form khách hàng mới
    customerSelect.addEventListener('change', function() {
      if (this.value === 'new') {
        newCustomerInfo.style.display = 'block';
      } else {
        newCustomerInfo.style.display = 'none';
      }
    });

    // Xử lý thêm sản phẩm
    addProductBtn.addEventListener('click', function() {
      addProductModal.show();
    });

    confirmAddProduct.addEventListener('click', function() {
      const name = document.getElementById('productName').value;
      const price = document.getElementById('productPrice').value;
      const quantity = document.getElementById('productQuantity').value;

      const productHtml = `
                    <div class="product-item mb-2">
                        <div class="row">
                            <div class="col">${name}</div>
                            <div class="col">${price} VNĐ</div>
                            <div class="col">${quantity}</div>
                            <div class="col">${price * quantity} VNĐ</div>
                            <div class="col">
                                <button type="button" class="btn btn-sm btn-danger remove-product">Xóa</button>
                            </div>
                        </div>
                    </div>
                `;

      productList.insertAdjacentHTML('beforeend', productHtml);
      updateTotal();
      addProductModal.hide();
    });

    // Xử lý xóa sản phẩm
    productList.addEventListener('click', function(e) {
      if (e.target.classList.contains('remove-product')) {
        e.target.closest('.product-item').remove();
        updateTotal();
      }
    });

    // Cập nhật tổng tiền
    function updateTotal() {
      let total = 0;
      document.querySelectorAll('.product-item').forEach(item => {
        const price = parseFloat(item.querySelector('.col:nth-child(2)').textContent);
        const quantity = parseInt(item.querySelector('.col:nth-child(3)').textContent);
        total += price * quantity;
      });
      totalAmount.textContent = total.toLocaleString();
    }

    // Xử lý in hóa đơn
    printInvoiceBtn.addEventListener('click', function() {
      const doc = new jsPDF();

      doc.text('Hóa đơn bán hàng', 10, 10);
      doc.text('Ngày: ' + new Date().toLocaleDateString(), 10, 20);

      let yPos = 30;
      document.querySelectorAll('.product-item').forEach(item => {
        const name = item.querySelector('.col:nth-child(1)').textContent;
        const price = item.querySelector('.col:nth-child(2)').textContent;
        const quantity = item.querySelector('.col:nth-child(3)').textContent;
        const total = item.querySelector('.col:nth-child(4)').textContent;

        doc.text(`${name} - ${price} x ${quantity} = ${total}`, 10, yPos);
        yPos += 10;
      });

      doc.text(`Tổng cộng: ${totalAmount.textContent} VNĐ`, 10, yPos + 10);

      doc.save('hoa-don.pdf');
    });
  });
</script>
</body>
</html>