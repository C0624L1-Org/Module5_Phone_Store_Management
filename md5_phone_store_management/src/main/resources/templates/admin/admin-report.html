<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Báo cáo</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
<div class="wrapper">
    <!-- Sidebar (giữ nguyên như các trang khác) -->

    <!-- Page Content -->
    <div id="content">
        <!-- Top Navbar (giữ nguyên như các trang khác) -->

        <!-- Main Content -->
        <div class="container-fluid">
            <h2 class="mb-4">Quản lý Báo cáo</h2>

            <!-- Tabs for different reports -->
            <ul class="nav nav-tabs mb-4" id="reportTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="sales-report-tab" data-bs-toggle="tab" data-bs-target="#sales-report" type="button" role="tab">Báo cáo Bán hàng</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="customer-list-tab" data-bs-toggle="tab" data-bs-target="#customer-list" type="button" role="tab">Danh sách Khách hàng</button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="reportTabsContent">
                <!-- Báo cáo Bán hàng -->
                <div class="tab-pane fade show active" id="sales-report" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Báo cáo Bán hàng theo Sản phẩm</h5>
                            <div class="mb-3">
                                <label for="brandSelect" class="form-label">Chọn hãng điện thoại:</label>
                                <select class="form-select" id="brandSelect">
                                    <option value="all">Tất cả các hãng</option>
                                    <option value="Apple">Apple</option>
                                    <option value="Samsung">Samsung</option>
                                    <option value="Xiaomi">Xiaomi</option>
                                    <!-- Thêm các hãng khác -->
                                </select>
                            </div>
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Danh sách Khách hàng -->
                <div class="tab-pane fade" id="customer-list" role="tabpanel">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Danh sách Khách hàng</h5>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th>Mã KH</th>
                                        <th>Tên khách hàng</th>
                                        <th>Số điện thoại</th>
                                        <th>Email</th>
                                        <th>Tổng số đơn hàng</th>
                                        <th>Thao tác</th>
                                    </tr>
                                    </thead>
                                    <tbody id="customerTableBody">
                                    <!-- Dữ liệu sẽ được thêm vào đây bằng JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Lịch sử Mua hàng -->
<div class="modal fade" id="purchaseHistoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Lịch sử Mua hàng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Ngày mua</th>
                        <th>Sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Tổng tiền</th>
                    </tr>
                    </thead>
                    <tbody id="purchaseHistoryBody">
                    <!-- Dữ liệu sẽ được thêm vào đây bằng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Custom JS -->
<script>
    // Dữ liệu mẫu cho biểu đồ bán hàng
    const salesData = {
        labels: ['iPhone 15 Pro Max', 'Samsung Galaxy S24 Ultra', 'Xiaomi 14 Pro', 'OPPO Find X7', 'Vivo X100 Pro'],
        datasets: [{
            label: 'Số lượng bán',
            data: [150, 120, 100, 80, 60],
            backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(75, 192, 192, 0.5)',
                'rgba(153, 102, 255, 0.5)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
        }]
    };

    // Vẽ biểu đồ bán hàng
    const ctx = document.getElementById('salesChart').getContext('2d');
    const salesChart = new Chart(ctx, {
        type: 'bar',
        data: salesData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Báo cáo Bán hàng theo Sản phẩm'
                }
            }
        }
    });

    // Xử lý thay đổi hãng điện thoại
    document.getElementById('brandSelect').addEventListener('change', function() {
        // Ở đây bạn sẽ cập nhật dữ liệu biểu đồ dựa trên hãng được chọn
        // Ví dụ:
        if (this.value === 'Apple') {
            salesChart.data.labels = ['iPhone 15 Pro Max', 'iPhone 15 Pro', 'iPhone 15', 'iPhone 14 Pro', 'iPhone 14'];
            salesChart.data.datasets[0].data = [150, 130, 110, 90, 70];
        } else if (this.value === 'Samsung') {
            salesChart.data.labels = ['Galaxy S24 Ultra', 'Galaxy S24+', 'Galaxy S24', 'Galaxy Z Fold5', 'Galaxy Z Flip5'];
            salesChart.data.datasets[0].data = [120, 100, 90, 80, 60];
        } else {
            // Khôi phục dữ liệu ban đầu cho tất cả các hãng
            salesChart.data = salesData;
        }
        salesChart.update();
    });

    // Dữ liệu mẫu cho danh sách khách hàng
    const customers = [
        { id: 'KH001', name: 'Nguyễn Văn A', phone: '0901234567', email: 'nguyenvana@email.com', totalOrders: 5 },
        { id: 'KH002', name: 'Trần Thị B', phone: '0912345678', email: 'tranthib@email.com', totalOrders: 3 },
        { id: 'KH003', name: 'Lê Văn C', phone: '0923456789', email: 'levanc@email.com', totalOrders: 7 },
    ];

    // Render danh sách khách hàng
    function renderCustomers() {
        const tbody = document.getElementById('customerTableBody');
        tbody.innerHTML = '';
        customers.forEach(customer => {
            tbody.innerHTML += `
                    <tr>
                        <td>${customer.id}</td>
                        <td>${customer.name}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.email}</td>
                        <td>${customer.totalOrders}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewPurchaseHistory('${customer.id}')">
                                <i class="fas fa-history"></i> Lịch sử mua hàng
                            </button>
                        </td>
                    </tr>
                `;
        });
    }

    // Xem lịch sử mua hàng
    function viewPurchaseHistory(customerId) {
        // Ở đây bạn sẽ lấy dữ liệu lịch sử mua hàng từ server
        // Đây là dữ liệu mẫu
        const purchaseHistory = [
            { date: '2024-03-01', product: 'iPhone 15 Pro Max', quantity: 1, total: 29990000 },
            { date: '2024-02-15', product: 'Samsung Galaxy S24 Ultra', quantity: 1, total: 28990000 },
            { date: '2024-01-20', product: 'AirPods Pro', quantity: 1, total: 5990000 },
        ];

        const purchaseHistoryBody = document.getElementById('purchaseHistoryBody');
        purchaseHistoryBody.innerHTML = '';
        purchaseHistory.forEach(purchase => {
            purchaseHistoryBody.innerHTML += `
                    <tr>
                        <td>${purchase.date}</td>
                        <td>${purchase.product}</td>
                        <td>${purchase.quantity}</td>
                        <td>${purchase.total.toLocaleString()} VNĐ</td>
                    </tr>
                `;
        });

        const purchaseHistoryModal = new bootstrap.Modal(document.getElementById('purchaseHistoryModal'));
        purchaseHistoryModal.show();
    }

    renderCustomers();
</script>
</body>
</html>