<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bán hàng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/fragments/navbar.css">
    <link rel="stylesheet" href="/css/fragments/sidebar.css"/>
    <link rel="stylesheet" href="/css/fragments/footer.css">
    <link rel="stylesheet" href="/css/dashboard/dashboard.css">
</head>
<body>
<!-- Hiển thị thông báo -->
<div th:replace="~{common/toast}"></div>

<!-- Nhúng navbar -->
<nav th:replace="~{fragments/navbar :: navbar}"></nav>

<div class="content-wrapper">
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside th:replace="~{fragments/sidebar :: sidebar}"></aside>

        <!-- Main content -->
        <div class="content-container">
            <div class="container-fluid py-4">
                <div class="card">
                    <div class="card-header bg-light">
                        <h4>Bán hàng</h4>
                    </div>
                    <form class="form" th:action="@{/dashboard/sales/add}" method="POST" th:object="${invoice}">
                        <div class="card-body">
                            <!-- Thông tin khách hàng -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    Thông tin khách hàng
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="btn btn-outline-secondary w-100" id="selectOldCustomer">Chọn
                                                khách hàng cũ
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="btn btn-outline-secondary w-100" id="scanQR" disabled>Quét mã
                                                QR
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <input type="hidden" id="customerID" th:field="*{customer.customerID}">
                                        <label for="hoTen" class="form-label">Họ và tên</label>
                                        <input type="text" class="form-control" id="hoTen"
                                               th:field="*{customer.fullName}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="soDienThoai" class="form-label">Số điện thoại</label>
                                        <input type="tel" class="form-control" id="soDienThoai"
                                               th:field="*{customer.phone}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="diaChi" class="form-label">Địa chỉ</label>
                                        <input type="text" class="form-control" id="diaChi"
                                               th:field="*{customer.address}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="tuoi" class="form-label">Tuổi</label>
                                        <input type="number" class="form-control" id="tuoi" style="width: 150px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">e-mail</label>
                                        <input type="email" class="form-control" id="email"
                                               th:field="*{customer.email}">
                                    </div>
                                </div>
                            </div>

                            <!-- Thông tin sản phẩm -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    Thông tin sản phẩm
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="btn btn-outline-secondary w-100 mb-3" id="selectOldProduct">Chọn sản
                                            phẩm
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="tenSanPham" class="form-label">Tên sản phẩm</label>
                                        <input type="text" class="form-control" id="tenSanPham">
                                    </div>
                                    <div class="mb-3">
                                        <label for="donGia" class="form-label">Đơn giá</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="donGia">
                                            <span class="input-group-text">VND</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="soLuong" class="form-label">Số lượng</label>
                                        <input type="number" class="form-control" id="soLuong" style="width: 150px;">
                                    </div>
                                    <button class="btn btn-primary">+ Thêm sản phẩm</button>
                                </div>
                            </div>

                            <!-- Thanh toán -->
                            <div class="mb-3">
                                <label for="thanhTien" class="form-label">Thành tiền</label>
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="thanhTien" readonly>
                                    <span class="input-group-text">VND</span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Hình thức thanh toán</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="hinhThucThanhToan"
                                           id="theTinDung" checked>
                                    <label class="form-check-label" for="theTinDung">
                                        Thẻ tín dụng
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="hinhThucThanhToan" id="tienMat">
                                    <label class="form-check-label" for="tienMat">
                                        Tiền mặt
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="inHoaDon" checked>
                                <label class="form-check-label" for="inHoaDon">In hóa đơn</label>
                            </div>

                            <button type="submit" class="btn btn-success">Tiến hành thanh toán</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer th:replace="~{fragments/footer :: footer}"></footer>
    <!-- Modal for Customer -->
    <div class="modal fade" id="customerModal" tabindex="-1" aria-labelledby="customerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="customerModalLabel">Danh sách khách hàng</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Tìm kiếm -->
                    <div class="d-flex mb-3">
                        <select id="searchType" class="form-select me-2">
                            <option value="name">Tên khách hàng</option>
                            <option value="phone">Số điện thoại</option>
                            <option value="email">Email</option>
                        </select>
                        <input type="text" id="searchInput" class="form-control me-2" placeholder="Nhập từ khóa...">
                        <button class="btn btn-primary" onclick="searchCustomer()">Tìm kiếm</button>
                    </div>
                    <!-- Danh sách khách hàng -->
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th>Họ và Tên</th>
                            <th>Số điện thoại</th>
                            <th>Địa chỉ</th>
                            <th>Tuổi</th>
                            <th>Email</th>
                            <th>Chọn</th>
                        </tr>
                        </thead>
                        <tbody id="customerTable">
                        <tr th:each="customer : ${customerList}" class="customer-row"
                            th:with="age=${customer.dob != null ? T(java.time.Period).between(customer.dob.toLocalDate(), T(java.time.LocalDate).now()).getYears() : 0}">
                            <td th:text="${customer.fullName}" class="name"></td>
                            <td th:text="${customer.phone}" class="phone"></td>
                            <td th:text="${customer.address}" class="address"></td>
                            <td th:text="${age}" class="age"></td>
                            <td th:text="${customer.email}" class="email"></td>
                            <td>
                                <button class="btn btn-success btn-select-customer"
                                        th:data-name="${customer.fullName}"
                                        th:data-phone="${customer.phone}"
                                        th:data-email="${customer.email}"
                                        th:data-address="${customer.address}"
                                        th:data-age="${age}"
                                        th:data-id="${customer.customerID}">
                                    Chọn
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Nhúng script navbar -->
<div th:replace="~{fragments/navbar :: navbar-script}"></div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>

    document.getElementById("selectOldCustomer").addEventListener('click', function () {
        // Hiển thị modal Bootstrap
        console.log("mở modal")
        new bootstrap.Modal(document.getElementById("customerModal")).show();
    });

    document.querySelectorAll(".btn-select-customer").forEach(button => {
        button.addEventListener("click", function () {
            console.log("đã click");
            console.log(this.getAttribute("data-name"));
            document.querySelector("input[id='hoTen']").value = this.getAttribute("data-name");
            document.querySelector("input[id='soDienThoai']").value = this.getAttribute("data-phone");
            document.querySelector("input[id='email']").value = this.getAttribute("data-email");
            document.querySelector("input[id='diaChi']").value = this.getAttribute("data-address");
            document.querySelector("input[id='tuoi']").value = this.getAttribute("data-age");
            document.querySelector("input[id='customerID']").value = this.getAttribute("data-id");
            console.log(document.getElementById('hoTen').value);

            // Đóng modal sau khi chọn
            let modal = bootstrap.Modal.getInstance(document.getElementById("customerModal"));
            modal.hide();
        });
    });

</script>
</body>
</html>